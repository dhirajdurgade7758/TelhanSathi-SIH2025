{% extends "base.html" %}

{% block title %}‡§≤‡§æ‡§≠ ‡§∏‡§ø‡§Æ‡•Å‡§≤‡•á‡§ü‡§∞ - ‡§§‡•á‡§≤‡§π‡§® ‡§∏‡§æ‡§•‡•Ä{% endblock %}

{% block content %}

        <!-- Loader Overlay -->
        <div id="loaderOverlay" class="loader-overlay">
            <div class="spinner"></div>
            <div class="loader-text">‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§®‡•Å‡§Æ‡§æ‡§® ‡§ï‡•Ä ‡§ó‡§£‡§®‡§æ ‡§ú‡§æ‡§∞‡•Ä ‡§π‡•à...</div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Summary Card -->
            <div class="card">
                <h2 class="card-title">üåæ ‡§§‡§ø‡§≤‡§π‡§® ‡§≤‡§æ‡§≠ ‡§ï‡•à‡§≤‡§ï‡•Å‡§≤‡•á‡§ü‡§∞</h2>
                <div id="summary-line" class="summary-text">‡§Ü‡§™‡§ï‡§æ ‡§ñ‡•á‡§§ ‡§ï‡§æ ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à‚Ä¶</div>
                
                <!-- Error Message -->
                <div id="errorMessage" class="error-message">
                    <div class="error-title" id="errorTitle">‡§§‡•ç‡§∞‡•Å‡§ü‡§ø</div>
                    <div class="error-details" id="errorDetails"></div>
                </div>
            </div>

            <!-- Input Section -->
            <div class="card">
                <h3 class="card-subtitle">‡§§‡§ø‡§≤‡§π‡§® ‡§´‡§∏‡§≤ ‡§î‡§∞ ‡§™‡•à‡§∞‡§æ‡§Æ‡•Ä‡§ü‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç</h3>
                
                <!-- Region Selection -->
                <div class="row">
                    <div class="col">
                        <label>‡§∞‡§æ‡§ú‡•ç‡§Ø</label>
                        <select id="stateSelect" class="input-field" onchange="updateDistricts()"></select>
                    </div>
                    <div class="col">
                        <label>‡§ú‡§ø‡§≤‡§æ</label>
                        <select id="districtSelect" class="input-field"></select>
                    </div>
                </div>
                
                <!-- Crop and Parameters -->
                <div class="row">
                    <div class="col">
                        <label>‡§§‡§ø‡§≤‡§π‡§® ‡§´‡§∏‡§≤</label>
                        <select id="cropName" class="input-field"></select>
                    </div>
                    <div class="col">
                        <label>‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ (‡§è‡§ï‡§°‡§º)</label>
                        <input id="areaAcres" class="input-field" type="number" min="0.1" max="100" step="0.1" value="1">
                    </div>
                    <div class="col">
                        <label>‡§ï‡§ü‡§æ‡§à ‡§ï‡§æ ‡§Æ‡§π‡•Ä‡§®‡§æ</label>
                        <select id="harvestMonth" class="input-field"></select>
                    </div>
                    <div class="col" style="display: flex; align-items: flex-end;">
                        <button class="btn btn-simulate" id="simulateBtn" onclick="simulate()">
                            üìä ‡§ó‡§£‡§®‡§æ ‡§ï‡§∞‡•á‡§Ç
                        </button>
                    </div>
                </div>
            </div>

            <!-- Results Grid -->
            <div class="card">
                <h3 class="card-subtitle">üìä ‡§≤‡§æ‡§≠ ‡§ï‡§æ ‡§Ö‡§®‡•Å‡§Æ‡§æ‡§®</h3>
                <div class="result-grid">
                    <div class="result-box yield-box">
                        <div class="result-value" id="yieldVal">-</div>
                        <div class="result-label">‡§™‡•ç‡§∞‡§§‡§ø ‡§è‡§ï‡§°‡§º ‡§â‡§™‡§ú (‡§ï‡•ç‡§µ‡§ø‡§Ç‡§ü‡§≤)</div>
                    </div>
                    <div class="result-box price-box">
                        <div class="result-value" id="priceVal">-</div>
                        <div class="result-label">‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§Æ‡•Ç‡§≤‡•ç‡§Ø (‚Çπ/‡§ï‡•ç‡§µ‡§ø‡§Ç‡§ü‡§≤)</div>
                    </div>
                    <div class="result-box cost-box">
                        <div class="result-value" id="costVal">-</div>
                        <div class="result-label">‡§ï‡•Å‡§≤ ‡§á‡§®‡§™‡•Å‡§ü ‡§≤‡§æ‡§ó‡§§ (‚Çπ)</div>
                    </div>
                    <div class="result-box income-box">
                        <div class="result-value" id="incomeVal">-</div>
                        <div class="result-label">‡§∏‡§ï‡§≤ ‡§Ü‡§Ø (‚Çπ)</div>
                    </div>
                </div>
            </div>

            <!-- Chart -->
            <div class="card">
                <h3 class="card-subtitle">üíπ ‡§≤‡§æ‡§≠ ‡§ï‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£</h3>
                <div class="chart-container">
                    <canvas id="profitChart"></canvas>
                </div>
                <div class="profit-summary">
                    <div class="net-profit-display" id="netProfitDisplay">‚Çπ -</div>
                    <div class="net-profit-label">‡§∂‡•Å‡§¶‡•ç‡§ß ‡§≤‡§æ‡§≠</div>
                </div>
            </div>

            <!-- CTA Buttons -->
            <div class="card">
                <div class="button-group">
                    <button class="btn btn-primary" id="applySubsidy">‡§∏‡§¨‡•ç‡§∏‡§ø‡§°‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§µ‡•á‡§¶‡§® ‡§ï‡§∞‡•á‡§Ç</button>
                    <button class="btn btn-secondary" id="findBuyer">‡§ñ‡§∞‡•Ä‡§¶‡§æ‡§∞ ‡§ñ‡•ã‡§ú‡•á‡§Ç</button>
                </div>
            </div>
        </div>

        <style>
    


            .icon-button {
                width: 24px;
                height: 24px;
                fill: white;
                cursor: pointer;
            }

            .main-content {
                flex-grow: 1;
                overflow-y: auto;
                padding: 8px;
                padding-bottom: 80px;
            }

            .card {
                background: #fff;
                padding: 16px;
                border-radius: 10px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                margin-bottom: 15px;
            }

            .card-title {
                margin: 0 0 8px 0;
                font-size: 18px;
                font-weight: 600;
                color: #333;
            }

            .card-subtitle {
                margin: 0 0 12px 0;
                font-size: 15px;
                font-weight: 600;
                color: #333;
            }

            .summary-text {
                font-size: 13px;
                color: #666;
                line-height: 1.6;
            }

            .row {
                display: flex;
                gap: 12px;
                margin-bottom: 12px;
                align-items: flex-end;
            }

            .col {
                flex: 1;
            }

            label {
                font-size: 12px;
                color: #666;
                display: block;
                margin-bottom: 4px;
                font-weight: 500;
            }

            .input-field {
                width: 100%;
                padding: 10px;
                border-radius: 6px;
                border: 1px solid #ddd;
                font-size: 13px;
                transition: border-color 0.2s;
            }

            .input-field:focus {
                outline: none;
                border-color: #388e3c;
                box-shadow: 0 0 0 2px rgba(56, 142, 60, 0.1);
            }

            .result-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }

            .result-box {
                background: linear-gradient(135deg, #f5f7fa 0%, #ffffff 100%);
                padding: 14px;
                border-radius: 8px;
                text-align: center;
                border-left: 4px solid #388e3c;
                box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
            }

            .result-box.yield-box {
                border-left-color: #ffc107;
            }

            .result-box.price-box {
                border-left-color: #ff9800;
            }

            .result-box.cost-box {
                border-left-color: #f44336;
            }

            .result-box.income-box {
                border-left-color: #2196f3;
            }

            .result-value {
                font-size: 18px;
                font-weight: bold;
                color: #388e3c;
            }

            .result-label {
                font-size: 11px;
                color: #666;
                margin-top: 4px;
            }

            .chart-container {
                position: relative;
                height: 280px;
                margin: 20px 0;
            }

            .profit-summary {
                text-align: center;
                margin-top: 12px;
                padding: 12px;
                background: #f0f7f0;
                border-radius: 8px;
            }

            .net-profit-display {
                font-size: 24px;
                font-weight: bold;
                color: #2e7d32;
            }

            .net-profit-label {
                font-size: 12px;
                color: #666;
                margin-top: 4px;
            }

            .button-group {
                display: flex;
                gap: 12px;
            }

            .btn {
                padding: 12px 16px;
                border-radius: 8px;
                border: none;
                cursor: pointer;
                font-weight: 600;
                font-size: 14px;
                flex: 1;
                transition: all 0.3s ease;
            }

            .btn-simulate {
                padding: 10px 20px;
                background: linear-gradient(135deg, #388e3c 0%, #2e7d32 100%);
                color: #fff;
                flex: 0.8;
                min-width: 120px;
                box-shadow: 0 2px 8px rgba(56, 142, 60, 0.3);
                font-size: 13px;
            }

            .btn-simulate:hover {
                background: linear-gradient(135deg, #2e7d32 0%, #1b5e20 100%);
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(56, 142, 60, 0.4);
            }

            .btn-simulate:active {
                transform: translateY(0);
            }

            .btn-primary {
                background: #388e3c;
                color: #fff;
            }

            .btn-primary:hover {
                background: #2e7d32;
                box-shadow: 0 2px 8px rgba(56, 142, 60, 0.3);
            }

            .btn-secondary {
                background: #fff;
                border: 2px solid #388e3c;
                color: #388e3c;
            }

            .btn-secondary:hover {
                background: #f0f7f0;
                border-color: #2e7d32;
                color: #2e7d32;
            }

            @media (max-width: 420px) {
                .row {
                    flex-direction: column;
                }

                .col {
                    width: 100%;
                }
            }

            /* Spinner and Loader Styles */
            .loader-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.4);
                display: none;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                z-index: 9999;
            }

            .loader-overlay.active {
                display: flex;
            }

            .spinner {
                width: 50px;
                height: 50px;
                border: 4px solid rgba(255, 255, 255, 0.3);
                border-top-color: #fff;
                border-radius: 50%;
                animation: spin 1s linear infinite;
            }

            @keyframes spin {
                to { transform: rotate(360deg); }
            }

            .loader-text {
                color: #fff;
                font-size: 16px;
                margin-top: 20px;
                text-align: center;
                font-weight: 500;
            }

            .error-message {
                background: #ffebee;
                border-left: 4px solid #f44336;
                color: #c62828;
                padding: 12px;
                border-radius: 4px;
                margin: 10px 0;
                font-size: 13px;
                display: none;
            }

            .error-message.show {
                display: block;
            }

            .error-title {
                font-weight: 600;
                margin-bottom: 4px;
            }

            .error-details {
                font-size: 12px;
                color: #d32f2f;
            }
        </style>
{% endblock %}

{% block script %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script>
        let farmer = null;
        let oilseedsList = [];
        let harvestMonths = [];
        let chart = null;
        let availableRegions = {};
        let mlAvailable = false;

        const hindiMonths = {
            'January': '‡§ú‡§®‡§µ‡§∞‡•Ä', 'February': '‡§´‡§∞‡§µ‡§∞‡•Ä', 'March': '‡§Æ‡§æ‡§∞‡•ç‡§ö', 'April': '‡§Ö‡§™‡•ç‡§∞‡•à‡§≤',
            'May': '‡§Æ‡§à', 'June': '‡§ú‡•Ç‡§®', 'July': '‡§ú‡•Å‡§≤‡§æ‡§à', 'August': '‡§Ö‡§ó‡§∏‡•ç‡§§',
            'September': '‡§∏‡§ø‡§§‡§Ç‡§¨‡§∞', 'October': '‡§Ö‡§ï‡•ç‡§ü‡•Ç‡§¨‡§∞', 'November': '‡§®‡§µ‡§Ç‡§¨‡§∞', 'December': '‡§¶‡§ø‡§∏‡§Ç‡§¨‡§∞'
        };

        const hindiCrops = {
            'Mustard': '‡§∏‡§∞‡§∏‡•ã‡§Ç', 'Soybean': '‡§∏‡•ã‡§Ø‡§æ‡§¨‡•Ä‡§®', 'Groundnut': '‡§Æ‡•Ç‡§Ç‡§ó‡§´‡§≤‡•Ä',
            'Sesame': '‡§§‡§ø‡§≤', 'Linseed': '‡§Ö‡§≤‡§∏‡•Ä', 'Sunflower': '‡§∏‡•Ç‡§∞‡§ú‡§Æ‡•Å‡§ñ‡•Ä', 'Safflower': '‡§ï‡•Å‡§∏‡•Å‡§Æ'
        };

        function updateDistricts() {
            const stateSelect = document.getElementById('stateSelect');
            const districtSelect = document.getElementById('districtSelect');
            const selectedState = stateSelect.value;

            // Clear existing options
            districtSelect.innerHTML = '';

            // Get districts for selected state
            const districts = availableRegions[selectedState] || ['Indore'];
            
            districts.forEach(district => {
                const opt = document.createElement('option');
                opt.value = district;
                opt.textContent = district;
                districtSelect.appendChild(opt);
            });

            // Select first district
            if (districts.length > 0) {
                districtSelect.value = districts[0];
            }
        }

        async function init() {
            try {
                const res = await fetch('/profit/api/init', {credentials: 'same-origin'});
                const data = await res.json();
                if (data.error) { 
                    document.getElementById('summary-line').textContent = '‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ' + data.error; 
                    return; 
                }
                
                farmer = data.farmer;
                oilseedsList = data.oilseeds_list || [];
                harvestMonths = data.harvest_months || [];
                availableRegions = data.available_regions || {};
                mlAvailable = data.ml_available || false;

                // Update summary with Hindi
                document.getElementById('summary-line').textContent = 
                    `‡§ñ‡•á‡§§: ${farmer.name} | ‡§∞‡§æ‡§ú‡•ç‡§Ø: ${farmer.state} | ‡§ú‡§ø‡§≤‡§æ: ${farmer.district} | ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä: ${farmer.soil_type || 'N/A'} | ‡§ú‡§≤: ${farmer.water_type || 'N/A'}`;

                // Populate state dropdown
                const stateSel = document.getElementById('stateSelect');
                const stateOptions = data.state_options || [];
                stateOptions.forEach(state => {
                    const opt = document.createElement('option');
                    opt.value = state;
                    opt.textContent = state;
                    stateSel.appendChild(opt);
                });
                stateSel.value = data.selected_state || (stateOptions[0] || 'Maharashtra');

                // Populate district dropdown
                updateDistricts();

                // Populate crop dropdown
                const cropSel = document.getElementById('cropName');
                oilseedsList.forEach(crop => {
                    const opt = document.createElement('option');
                    opt.value = crop;
                    opt.textContent = hindiCrops[crop] || crop;
                    cropSel.appendChild(opt);
                });
                cropSel.value = farmer.current_crop || (oilseedsList[0] || 'Mustard');

                // Populate harvest month dropdown with Hindi names
                const harvestSel = document.getElementById('harvestMonth');
                harvestMonths.forEach(month => {
                    const opt = document.createElement('option');
                    opt.value = month;
                    opt.textContent = hindiMonths[month] || month;
                    harvestSel.appendChild(opt);
                });
                harvestSel.value = farmer.harvest_month || 'October';

                // Set area from farmer data
                document.getElementById('areaAcres').value = farmer.area_in_acres || 1;

                // Event listeners - optionally auto-simulate on change (disabled for now)
                // document.getElementById('cropName').addEventListener('change', simulate);
                // document.getElementById('areaAcres').addEventListener('change', simulate);
                // document.getElementById('harvestMonth').addEventListener('change', simulate);
                
                document.getElementById('applySubsidy').addEventListener('click', () => {
                    window.location.href = '/subsidies/list';
                });
                document.getElementById('findBuyer').addEventListener('click', () => {
                    alert('Marketplace has been removed. Please use the Bidding System to sell your crops.');
                });

                // Init chart
                const ctx = document.getElementById('profitChart').getContext('2d');
                chart = new Chart(ctx, {
                    type: 'bar',
                    data: {labels: [], datasets: []},
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: (v) => '‚Çπ' + (v/1000).toFixed(1) + 'K',
                                    color: '#666'
                                },
                                grid: {color: 'rgba(0,0,0,0.05)'}
                            },
                            x: {
                                ticks: {color: '#666'},
                                grid: {display: false}
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    color: '#666',
                                    font: {size: 12},
                                    padding: 12,
                                    usePointStyle: true
                                }
                            }
                        }
                    }
                });

                // Show initial message in Hindi
                document.getElementById('summary-line').textContent = 
                    `${farmer.name} ‚Ä¢ ${farmer.district} ‚Ä¢ ‡§ó‡§£‡§®‡§æ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§ø‡§Æ‡•Å‡§≤‡•á‡§ü ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç`;
            } catch (e) {
                document.getElementById('summary-line').textContent = '‡§ñ‡•á‡§§ ‡§ï‡§æ ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ' + e.message;
            }
        }

        async function simulate() {
            try {
                // Clear previous error
                const errorMsg = document.getElementById('errorMessage');
                errorMsg.classList.remove('show');

                // Validate region selection
                const stateSelect = document.getElementById('stateSelect');
                const districtSelect = document.getElementById('districtSelect');
                const selectedState = stateSelect.value;
                const selectedDistrict = districtSelect.value;

                // Check if region has data
                if (!availableRegions[selectedState] || !availableRegions[selectedState].includes(selectedDistrict)) {
                    showError('‡§°‡•á‡§ü‡§æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à', `${selectedState} - ${selectedDistrict} ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§°‡•á‡§ü‡§æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à`);
                    return;
                }

                const cropName = document.getElementById('cropName').value;
                const areaAcres = parseFloat(document.getElementById('areaAcres').value || 1);
                const harvestMonth = document.getElementById('harvestMonth').value;

                // Show loader
                document.getElementById('loaderOverlay').classList.add('active');

                const payload = {
                    crop_name: cropName,
                    state: selectedState,
                    market_district: selectedDistrict,
                    harvest_month: harvestMonth,
                    soil_type: farmer.soil_type || '',
                    water_type: farmer.water_type || 'Freshwater',
                    area_in_acres: areaAcres
                };

                const res = await fetch('/profit/api/simulate', {
                    method: 'POST',
                    credentials: 'same-origin',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });

                // Hide loader
                document.getElementById('loaderOverlay').classList.remove('active');

                const out = await res.json();
                
                // Check for API error
                if (out.error) {
                    console.error('API error:', out);
                    showError(out.error, out.details || '');
                    return;
                }

                // Check for HTTP error
                if (!res.ok) {
                    showError('‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø', `‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§ï‡•ã‡§°: ${res.status}`);
                    return;
                }

                const pred = out.prediction;

                // Extract values from ML response
                const yieldPerAcre = pred.yield_per_acre || 15;
                const pricePerQuintal = pred.forecast_price || 5000;
                const inputCost = pred.total_cost || 0;
                const grossIncome = pred.gross_revenue || 0;
                const netProfit = pred.net_profit || 0;
                const profitMargin = pred.profit_margin || '0%';
                const roi = pred.roi || '0%';
                const modelUsed = pred.model_used || 'ARIMA';
                const hindiCropName = hindiCrops[cropName] || cropName;

                // Update result boxes
                document.getElementById('yieldVal').textContent = yieldPerAcre.toFixed(2);
                document.getElementById('priceVal').textContent = '‚Çπ ' + pricePerQuintal.toLocaleString('en-IN', {maximumFractionDigits: 0});
                document.getElementById('costVal').textContent = '‚Çπ ' + Math.round(inputCost).toLocaleString('en-IN');
                document.getElementById('incomeVal').textContent = '‚Çπ ' + Math.round(grossIncome).toLocaleString('en-IN');
                document.getElementById('netProfitDisplay').textContent = '‚Çπ ' + Math.round(netProfit).toLocaleString('en-IN');

                // Update summary line with model info in Hindi
                const marginStr = typeof profitMargin === 'string' ? profitMargin : profitMargin.toFixed(1) + '%';
                const roiStr = typeof roi === 'string' ? roi : roi.toFixed(1) + '%';
                document.getElementById('summary-line').textContent = 
                    `${hindiCropName} ‚Ä¢ ‡§Æ‡§æ‡§∞‡•ç‡§ú‡§ø‡§®: ${marginStr} ‚Ä¢ ‡§∞‡§ø‡§ü‡§∞‡•ç‡§®: ${roiStr} ‚Ä¢ ‡§Æ‡•â‡§°‡§≤: ${modelUsed} ‚Ä¢ AI: ‚úÖ`;

                // Update bar chart with Hindi labels
                chart.data.labels = [hindiCropName];
                chart.data.datasets = [
                    {
                        label: '‡§á‡§®‡§™‡•Å‡§ü ‡§≤‡§æ‡§ó‡§§',
                        data: [inputCost],
                        backgroundColor: '#f44336',
                        borderRadius: 6
                    },
                    {
                        label: '‡§∏‡§ï‡§≤ ‡§Ü‡§Ø',
                        data: [grossIncome],
                        backgroundColor: '#2196f3',
                        borderRadius: 6
                    },
                    {
                        label: '‡§∂‡•Å‡§¶‡•ç‡§ß ‡§≤‡§æ‡§≠',
                        data: [netProfit],
                        backgroundColor: '#2e7d32',
                        borderRadius: 6
                    }
                ];
                chart.update();
            } catch (e) {
                console.error('Simulate error:', e);
                document.getElementById('loaderOverlay').classList.remove('active');
                showError('‡§Ö‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡§æ‡§∂‡§ø‡§§ ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø', e.message);
            }
        }

        function showError(title, details) {
            const errorMsg = document.getElementById('errorMessage');
            document.getElementById('errorTitle').textContent = title;
            document.getElementById('errorDetails').textContent = details;
            errorMsg.classList.add('show');
        }

        function goBack() {
            window.history.back();
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
{% endblock %}
